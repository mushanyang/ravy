#!/usr/bin/env bash

if hash gls 2>/dev/null; then LS_COMMAND=${LS_COMMAND:-gls}; fi

command "${LS_COMMAND:-ls}" -lFh --color=always --time-style=long-iso "$@" |
awk '
    NF>=8 {
        if ($3 == "'"$USER"'") {
          $3 = ""
          $4 = ""
        }
        path=$8
        for(i=9;i<=NF;i++){
            path=path " " $i
        }
        printf "%s\t|%s\t|%s %s\t|%s\t|%s\n", $1, $3 ":" $4, $6, $7, $5, path
    }
' |
column -t -s '	' |
sed 's/  |/|/g' |
awk '
    BEGIN {
        FS="|"
        OFS=" "
    }
    function c(s, color) {
        return "\033[38;5;" color "m" s "\033(B\033[m"
    }
    {
        # highlight executable permission & diminish permissions for directory
        if ($1 ~ /^d/) { color = 234 }
        else if ($1 ~ /^-..x[^[:space:]]+/) { color = 208 }
        else { color = 238 }
        $1 = c($1, color)

        # highlight root & diminish current user
        if ($2 ~ /^:/) { color = 234 }
        else if ($2 ~ /^root/) { color = 124 }
        $2 = c($2, color)

        # time
        $3 = c($3, 236)

        # size
        if ($4 ~ /^[0-9.]+K/) { color = 136 }
        else if ($4 ~ /^[0-9.]+[MGTP]/) { color = 172 }
        else { color = 58 }
        $4 = c($4, color)

        print
    }
'
